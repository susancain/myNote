一、微信公众平台概述
1、微信与微信公众平台的区别
微信是基于点对点关系
微信公众平台是基于一对多关系（5000人是一个上限）
2、为什么要学习微信公众平台开发
2013年6月速途研究院发布调查报告，22%的微信用户在使用订阅公众帐号功能，而只算微信有3亿用户，就约有6000多万用户在使用微信公众平台功能。
二、微信公众平台的使用
2、微信公众平台的相关模式
编辑模式：是使用腾讯提供的Web平台对微信公众账号进行管理
开发者模式：是使用PHP源代码对微信公众账号进行管理
3、编辑模式的使用
1）群发功能
订阅号：不需要公司资质认证，个人可以注册，每天可以群发一条信息
服务号：需要公司资质认证，企业可以注册，每月可以群发四条信息
2）自动回复
① 被添加自动回复（订阅回复或关注回复）：当我们关注某个微信公众平台时，系统会自动回复此信息。
② 关键词自动回复：当我们发送的关键词与微信公众平台设置的关键词相匹配时，系统会自动回复匹配的信息。
未全匹配：当用户输入的关键词包含微信公众平台设定的关键词时，回复此信息
已全匹配：当用户输入的关键词与微信公众平台设定的关键词完全匹配时，回复此信息
③ 消息自动回复：当用户输入的关键词与微信公众平台设定的关键词不匹配时，系统自动回复此信息
三、微信开发者模式
1、前期准备
微信公众平台、在线的服务器（SAE或BAE）、SVN客户端软件
2、微信公众平台开发原理图
编辑模式原理图
开发者模式原理图

四、微信的API接口分析
所谓的API接口主要是连接微信公众平台与自定义服务器的桥梁
1、下载API接口文档
选择开发者必读接入指南
向下翻页到如下图所示界面，单击下载API接口
2、配置SAE云引擎
① 创建应用，如下图所示
② 单击gzbae进入管理平台
③ 创建版本号1
④ 复制仓库地址进行管理源代码

输入微信账号的安全邮箱与安全密码，如果不记得了，请进入微博账号管理进行重新设置

这个账号和密码就是我们登陆SAE的账号和密码，谨记！！！
⑤ 源码分析
config.yaml ：配置文件，请勿删除！！！
index.php ：入口文件
3、接入微信公众平台
① 解压api接口文件，如下图所示：
② 复制wx_sample.php接口文件到SAE中并改名为api.php
③ 设置接头暗号
④ 设置完成后，通过SVN上传到服务器中
4、配置微信公众平台
① 进入管理平台 https://mp.weixin.qq.com，进入开发者中心
② 配置自定义服务器地址
③ 单击提交即可
④ 提交成功后，单击启用按钮
如显示如下界面，代表设置成功

5、开启微信的自动回复（默认关闭的）
① 在zend创建一个微信项目
② 分析valid验证方法
③ 微信验证成功后，请注释掉valid方法
④ 开启微信的自动回复功能
再次测试，如下图所示：
6、自动回复功能详解

五、微信的6大接收接口

1、文本消息接口
① 分析XML结构体
通过以上XML结构体分析可知，如果用户发送的XML数据中MsgType节点为”text“，则代表用户发送的就是文本消息接口。
② 定义$msgType变量，用于获取MsgType节点信息（XML是严格区别大小写）
③ 判断$msgType类型是否为text
编写完成后，通过SVN上传到SAE服务器中，测试效果如下图所示：
2、图片消息接口
① 分析XML的结构体
② 判断$msgType为”image“，代表用户发送的是图片消息
③ 通过SVN上传源代码，测试结果如下图所示：
3、语音消息接口
① 分析语音消息XML结构体
② 判断$msgType变量为”voice”，代表用户发送的就是语音消息
③ 通过SVN上传到SAE服务器，测试效果如下图所示：
4、视频消息（视频消息与小视频消息）
① 分析视频消息XML结构体
视频消息：
小视频消息：
通过以上XML结构分析可知，如果用户发送的数据节点$msgType=“video”或”shortvideo”代表用户发送的就是视频消息接口
② 判断$msgType消息类型
③ 通过SVN上传，测试效果如下图所示：
5、地理位置消息接口
① 分析XML结构体
通过以上XML结构体分析可知，如果用户发送的消息类型为location代表用户发送的是地理位置信息。
② 判断$msgType=“location”，代表用户发送的就是地理位置消息
③ 通过SVN上传，测试效果如下图所示：
6、链接消息接口
① 分析XML结构体
通过XML结构体分析可知，如果用户发送的$msgType=’link’，代表用户发送的就是链接消息（图文消息）
② 判断$msgType参数
③ 通过SVN上传即可，测试效果如下图所示：

六、微信3大回复接口
1、文本回复接口
① 分析文本回复接口XML数据(换行，使用\n换行符，谨记！！！)
② 使用文本回复接口
1）组装XML数据
2）设置相关参数
3）格式化数据（sprintf）
要使用到的知识点：sprintf函数，基本语法：
string  sprintf ( string $format [, mixed $args [, mixed $... ]] ) ：返回格式化后的字符串
参数说明：
$format ：要格式化的字符串
$args ：要格式化的变量
格式化的数据类型：%d 格式化为整型  %s 格式化为字符串类型
sprintf函数主要功能：格式化XML格式的数据，组装成满足条件的XML结构体
4）返回输出格式化后的字符串（XML结构体）
案例：使用文本回复接口编写简易号码簿
2、音乐回复接口
3、图文回复接口

七、LBS接口
1、什么是LBS
LBS（Location Based Service）：基于地理位置的服务
2、几个概念
$longitude 经度
$latitude 纬度
3、地理位置接收消息接口
① 分析地理位置消息接口的XML数据

当用户发送的地理位置信息到微信公众平台时，发送过来的MsgType节点值为location，与此同时，其也会发送两个节点信息：
Location_X ：纬度信息
Location_Y ：经度信息
在实际项目开发中，我们通过地理位置的经纬度信息获取用户的详细位置

② 定义两个变量接收经纬度信息
③ 判断$msgType==’location’类型
④ 如何获取用户的详细位置（第三方接口开发）
1）登录百度开发者平台：http://developer.baidu.com/map/
2）使用反Geocoding获取用户的详细位置
分析相关参数：可知：
必须参数，ak(密钥),location(经纬度),output(输出格式)
3）单独定义一个页面，模拟发送get请求
4）整合lbs接口到微信的api中
通过SVN上传到SAE服务器中，测试效果如下图所示：

4、测距接口
案例：假设我们有3家酒店，当用户向公众平台发送地理位置消息时，自动返回最近的酒店
第一家酒店位置：113.3096,23.150196	动物园
第二家酒店位置：113.354156,23.131985 暨南大学
第三家酒店位置：113.401838,23.130755 车陂店
当用户发送地理位置信息时，可以返回最近的一家酒店。

① 测试接口
分析接口可知：必须传递三个参数ak(密钥)、waypoints(测距的点)、output
② 模拟使用get请求
③ 整合到微信的api接口中
④ 通过SVN上传到SAE中，测试结果如下：

扩展功能：高德地图API
http://lbs.amap.com/ 地理位置导航
在实际项目开发中，我们可以使用URI API返回相关信息（路线图、下点工具）

八、微信机器人开发
1、为什么需要微信机器人
在实际项目开发中，如果用户输入的关键词与我们设定的关键词不匹配时，系统不会返回任何数据，所以用户体验不是特别好，这个时候我们可以借助第三方接口来实现自动回复。
2、图灵机器人
http://www.tuling123.com/openapi/ 
3、使用微信公众平台接入图灵机器人
定义请求的地址
上传测试后效果如下图所示：

九、实现微信语音识别功能
1、开启语音识别
2、语音的XML模板（voice）
通过分析可知，如果用户发送的是语音消息接口且开启了语音识别，系统会自动生成识别后的结果。
① 定义一个变量，接收语音识别后的结果
② 在语音消息接口中，调用图灵机器人
③ 上传测试（首先要取消关注并再次关注）